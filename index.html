<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Puzzle Cache</title>
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 2em;
      background-color: #f4f4f4;
      color: #333;
    }
    .stage {
      display: none;
      background-color: #fff;
      padding: 2em;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      max-width: 800px;
      margin: 2em auto;
    }
    .active {
      display: block;
    }
    button {
      padding: 0.8em 1.5em;
      margin-top: 1.5em;
      background-color: white;
      color: black;
      border: 1px solid black;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1em;
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }
    button:hover {
      background-color: #e0e0e0;
      border-color: #555;
    }
    .retry-button { /* No longer strictly needed as no retriable games, but kept for consistency */
      background-color: #f44336;
      color: white;
      border: 1px solid #f44336;
    }
    .retry-button:hover { /* No longer strictly needed as no retriable games, but kept for consistency */
      background-color: #da190b;
      border-color: #da190b;
    }

    input[type="text"], input[type="number"], input[type="password"] {
      padding: 0.5em;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: calc(100% - 1em);
      max-width: 300px;
    }

    /* Trivia Specific Styles */
    #triviaForm {
      text-align: left;
      max-width: 700px;
      margin: 0 auto;
    }
    .trivia-question {
      margin-bottom: 2em;
      padding: 1.5em;
      border: 1px solid #ddd;
      border-radius: 8px;
      background-color: #fdfdfd;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }
    .trivia-question p {
      margin-top: 0;
      margin-bottom: 1em;
      font-weight: bold;
      font-size: 1.1em;
    }
    .trivia-question label {
      display: flex;
      align-items: center;
      margin-bottom: 0.8em;
      cursor: pointer;
      padding: 0.5em 0.8em;
      border: 1px solid transparent;
      border-radius: 5px;
      transition: background-color 0.2s ease, border-color 0.2s ease;
      font-size: 1.05em;
    }
    .trivia-question label input[type="radio"] {
      width: 1.5em;
      height: 1.5em;
      margin-right: 1em;
      flex-shrink: 0;
      -webkit-appearance: radio;
      -moz-appearance: radio;
      appearance: radio;
    }
    .trivia-question input[type="radio"]:checked + label {
      background-color: #d4edda;
      border-color: #28a745;
      color: #155724;
      font-weight: bold;
    }

    #triviaResult {
      margin-top: 1.5em;
      font-weight: bold;
    }

    /* Standardized button for starting online puzzle (no longer used in this context but kept class) */
    .start-online-puzzle-button {
        display: inline-block;
        background-color: #007bff;
        color: white;
        padding: 12px 24px;
        text-align: center;
        text-decoration: none;
        font-size: 1.1em;
        font-weight: bold;
        border-radius: 8px;
        filter: brightness(90%);
        transition: background-color 0.3s ease;
    }
    .start-online-puzzle-button:hover {
        background-color: #0056b3;
        filter: none;
    }

  </style>
</head>
<body>
  <div id="stage1" class="stage active">
    <h2>Stage 1: London Underground Trivia Challenge</h2>
    <p>Test your knowledge of the London Underground, especially the Piccadilly Line and Hatton Cross.</p>
    <form id="triviaForm">
      <div class="trivia-question">
        <p>1. What was the *exact date* Hatton Cross Station officially opened?</p>
        <input type="radio" id="q1a1" name="q1" value="July 17, 1974"><label for="q1a1">July 17, 1974</label><br>
        <input type="radio" id="q1a2" name="q1" value="July 19, 1975"><label for="q1a2">July 19, 1975</label><br>
        <input type="radio" id="q1a3" name="q1" value="August 23, 1976"><label for="q1a3">August 23, 1976</label><br>
        <input type="radio" id="q1a4" name="q1" value="September 1, 1975"><label for="q1a4">September 1, 1975</label>
      </div>

      <div class="trivia-question">
        <p>2. Prior to Hatton Cross, which station served as the western terminus of the Piccadilly Line's Hounslow branch before the Heathrow extension was built?</p>
        <input type="radio" id="q2a1" name="q2" value="Hounslow Central"><label for="q2a1">Hounslow Central</label><br>
        <input type="radio" id="q2a2" name="q2" value="South Harrow"><label for="q2a2">South Harrow</label><br>
        <input type="radio" id="q2a3" name="q2" value="Hounslow West"><label for="q2a3">Hounslow West</label><br>
        <input type="radio" id="q2a4" name="q2" value="Acton Town"><label for="q2a4">Acton Town</label>
      </div>

      <div class="trivia-question">
        <p>3. The Piccadilly Line's tunnels are generally considered "deep-level". What is the approximate *internal diameter* of these deep-level tube tunnels?</p>
        <input type="radio" id="q3a1" name="q3" value="9 feet (2.7m)"><label for="q3a1">9 feet (2.7m)</label><br>
        <input type="radio" id="q3a2" name="q3" value="11 feet 8 inches (3.5m)"><label for="q3a2">11 feet 8 inches (3.5m)</label><br>
        <input type="radio" id="q3a3" name="q3" value="14 feet (4.3m)"><label for="q3a3">14 feet (4.3m)</label><br>
        <input type="radio" id="q3a4" name="q3" value="18 feet (5.5m)"><label for="q3a4">18 feet (5.5m)</label>
      </div>

      <div class="trivia-question">
        <p>4. Which architect is credited with designing the iconic diagrammatic London Underground map, first introduced in 1933?</p>
        <input type="radio" id="q4a1" name="q4" value="Charles Holden"><label for="q4a1">Charles Holden</label><br>
        <input type="radio" id="q4a2" name="q4" value="Frank Pick"><label for="q4a2">Frank Pick</label><br>
        <input type="radio" id="q4a3" name="q4" value="Harry Beck"><label for="q4a3">Harry Beck</label><br>
        <input type="radio" id="q4a4" name="q4" value="Leslie Green"><label for="q4a4">Leslie Green</label>
      </div>

      <div class="trivia-question">
        <p>5. Hatton Cross Station is located within Transport for London's zonal system. Which two fare zones does it span?</p>
        <input type="radio" id="q5a1" name="q5" value="Zone 4 and 5"><label for="q5a1">Zone 4 and 5</label><br>
        <input type="radio" id="q5a2" name="q5" value="Zone 5 and 6"><label for="q5a2">Zone 5 and 6</label><br>
        <input type="radio" id="q5a3" name="q5" value="Zone 6 and 7"><label for="q5a3">Zone 6 and 7</label><br>
        <input type="radio" id="q5a4" name="q5" value="Zone 4 and 6"><label for="q5a4">Zone 4 and 6</label>
      </div>

      <div class="trivia-question">
        <p>6. Beyond Hatton Cross, and excluding the dedicated Terminal 4 loop, which primary Heathrow Airport Terminals are directly served by the Piccadilly Line?</p>
        <input type="radio" id="q6a1" name="q6" value="Terminal 1 & Terminal 2"><label for="q6a1">Terminal 1 & Terminal 2</label><br>
        <input type="radio" id="q6a2" name="q6" value="Terminals 2 & 3 & Terminal 5"><label for="q6a2">Terminals 2 & 3 & Terminal 5</label><br>
        <input type="radio" id="q6a3" name="q6" value="Terminal 4 & Terminal 5"><label for="q6a3">Terminal 4 & Terminal 5</label><br>
        <input type="radio" id="q6a4" name="q6" value="Terminal 1 & Terminal 3 & Terminal 4"><label for="q6a4">Terminal 1 & Terminal 3 & Terminal 4</label>
      </div>

      <div class="trivia-question">
        <p>7. Which former London Underground line's services were partially replaced by the Piccadilly Line's western extension towards Hounslow?</p>
        <input type="radio" id="q7a1" name="q7" value="Central Line"><label for="q7a1">Central Line</label><br>
        <input type="radio" id="q7a2" name="q7" value="District Line"><label for="q7a2">District Line</label><br>
        <input type="radio" id="q7a3" name="q7" value="Metropolitan Line"><label for="q7a3">Metropolitan Line</label><br>
        <input type="radio" id="q7a4" name="q7" value="Bakerloo Line"><label for="q7a4">Bakerloo Line</label>
      </div>

      <div class="trivia-question">
        <p>8. What is the specific type of rolling stock (train model) commonly used on the Piccadilly Line?</p>
        <input type="radio" id="q8a1" name="q8" value="S Stock"><label for="q8a1">S Stock</label><br>
        <input type="radio" id="q8a2" name="q8" value="1996 Stock"><label for="q8a2">1996 Stock</label><br>
        <input type="radio" id="q8a3" name="q8" value="1992 Stock"><label for="q8a3">1992 Stock</label><br>
        <input type="radio" id="q8a4" name="q8" value="1973 Stock"><label for="q8a4">1973 Stock</label>
      </div>

      <div class="trivia-question">
        <p>9. What type of station best describes Hatton Cross's track and platform level?</p>
        <input type="radio" id="q9a1" name="q9" value="Deep Level"><label for="q9a1">Deep Level</label><br>
        <input type="radio" id="q9a2" name="q9" value="SubSurface"><label for="q9a2">SubSurface</label><br>
        <input type="radio" id="q9a3" name="q9" value="Ground Level"><label for="q9a3">Ground Level</label><br>
        <input type="radio" id="q9a4" name="q9" value="Above Ground Level"><label for="q9a4">Above Ground Level</label>
      </div>

      <div class="trivia-question">
        <p>10. The extension of the Piccadilly Line beyond Hatton Cross to Heathrow Central (Terminals 2 & 3) opened in 1977. What was the *exact date* of this extension's opening?</p>
        <input type="radio" id="q10a1" name="q10" value="December 16, 1977"><label for="q10a1">December 16, 1977</label><br>
        <input type="radio" id="q10a2" name="q10" value="January 1, 1977"><label for="q10a2">January 1, 1977</label><br>
        <input type="radio" id="q10a3" name="q10" value="April 1, 1977"><label for="q10a3">April 1, 1977</label><br>
        <input type="radio" id="q10a4" name="q10" value="October 26, 1977"><label for="q10a4">October 26, 1977</label>
      </div>

      <button type="button" onclick="checkTrivia()">Submit Answers</button>
    </form>
    <p id="triviaResult"></p>
    <button id="triviaNext" style="display:none" onclick="showStage(2)">Next Puzzle</button>
  </div>

  <div id="stage2" class="stage">
    <h2>Stage 2: Decode the Cipher</h2>
    <p>The following code was created by shifting an original message's letters three places *down* the alphabet (e.g., 'D' becomes 'A', 'E' becomes 'B', 'C' becomes 'Z'). Keep numbers as they are.</p>
    <p>Decode this message: <strong><code>ExqqlkZolpp50</code></strong></p>
    <input id="cipherInput" placeholder="Your decoded answer" />
    <button onclick="checkCipher()">Check</button>
    <p id="cipherResult"></p>
    <button id="cipherNext" style="display:none" onclick="showStage('final')">Next Puzzle</button>
  </div>

  <div id="final" class="stage">
    <h2>🎉 Congratulations!</h2>
    <p>You've solved all the puzzles! Here are your final coordinates:</p>
    <p><strong>Coordinates:</strong> <span id="finalCoords">N 51° 27.985′ W 0° 25.397′</span></p>
    <p><strong>Hint:</strong> <span id="finalHint">Behind the box.</span></p>
    <button onclick="copyCoordsHint()">Copy Coords/Hint</button>
  </div>

  <script>
    function showStage(id) {
      document.querySelectorAll(".stage").forEach(el => el.classList.remove("active"));
      document.getElementById(typeof id === 'number' ? `stage${id}` : id).classList.add("active");
    }

    // --- Trivia check (now Stage 1) ---
    function checkTrivia() {
      const correctAnswers = {
        q1: "July 19, 1975",
        q2: "Hounslow West",
        q3: "11 feet 8 inches (3.5m)",
        q4: "Harry Beck",
        q5: "Zone 5 and 6",
        q6: "Terminals 2 & 3 & Terminal 5",
        q7: "District Line",
        q8: "1973 Stock",
        q9: "SubSurface",
        q10: "December 16, 1977"
      };

      let allCorrect = true;
      // Loop through all 10 questions
      for (let i = 1; i <= 10; i++) {
        const qName = `q${i}`;
        const selected = document.querySelector(`input[name="${qName}"]:checked`);
        if (!selected || selected.value !== correctAnswers[qName]) {
          allCorrect = false;
          break;
        }
      }

      const triviaResultElement = document.getElementById("triviaResult");
      if (allCorrect) {
        triviaResultElement.textContent = "Correct! All answers are right.";
        triviaResultElement.style.color = "#27ae60";
        document.getElementById("triviaNext").style.display = "inline";
      } else {
        triviaResultElement.textContent = "Incorrect. Please review your answers and try again.";
        triviaResultElement.style.color = "#e74c3c";
      }
    }

    // --- Cipher check (now Stage 2) ---
    function checkCipher() {
      const input = document.getElementById("cipherInput").value.trim();
      const cipherResultElement = document.getElementById("cipherResult");
     
      // The cipher is 'Hatton Cross 50' ENCODED by shifting 3 places down.
      // So, the user needs to DECODE it by shifting 3 places UP.
      // H->E, a->x, t->q, t->q, o->l, n->k
      // C->Z, r->o, o->l, s->p, s->p
      // Correct DECODED answer: HattonCross50 (was HattonCross25)
      if (input === "HattonCross50") { // NOW EXPECTING THE DECODED VALUE (50)
        cipherResultElement.textContent = "Correct!";
        cipherResultElement.style.color = "#27ae60";
        document.getElementById("cipherNext").style.display = "inline";
      } else {
        cipherResultElement.textContent = "Try again.";
        cipherResultElement.style.color = "#e74c3c";
      }
    }

    // --- Copy Coords/Hint Function ---
    async function copyCoordsHint() {
      const coords = document.getElementById("finalCoords").textContent;
      const hint = document.getElementById("finalHint").textContent;
      const textToCopy = `Coordinates: ${coords}\nHint: ${hint}`;

      try {
        const textarea = document.createElement('textarea');
        textarea.value = textToCopy;
        textarea.style.position = 'fixed';
        document.body.appendChild(textarea);
        textarea.focus();
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);
        alert("Coordinates and Hint copied to clipboard!");
      } catch (err) {
        console.error('Failed to copy text: ', err);
        alert("Failed to copy. Please copy manually: \n" + textToCopy);
      }
    }

    // Initialize the first stage (Trivia) on page load
    document.addEventListener("DOMContentLoaded", () => {
        showStage(1); // Show Stage 1 (Trivia) immediately
    });
  </script>
</body>
</html>
